name: CI

on:
  push:
  pull_request:

jobs:
  core-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install core deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements-core.txt
      - name: Run core checks
        run: |
          python -m py_compile core/settings.py core/monzo_client.py core/webhook_service.py stores/interfaces.py stores/memory_store.py stores/factory.py
          python -m unittest tests/test_webhook_service.py

  azure-adapter-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install azure deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements-azure.txt
      - name: Run azure adapter checks
        run: |
          python -m py_compile function_app.py stores/azure_table_store.py
          python -m unittest tests/adapters/test_azure_adapter.py

  fastapi-adapter-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install fastapi deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements-fastapi.txt
      - name: Run fastapi adapter checks
        run: |
          python -m py_compile app_fastapi.py
          python -m unittest tests/adapters/test_fastapi_adapter.py
